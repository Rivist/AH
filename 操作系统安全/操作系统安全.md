# 操作系统安全

## 1. 概述

主流操作系统：

- Windows 、 Linux 、MacOS 、Android、 IOS
- 常见漏洞：
  - 本地提权漏洞 低权限➡高权限
  - 远程代码执行

## 2. MetaSploit的使用

### 2.1 基本命令

![image-20220523100613676](操作系统安全.assets/image-20220523100613676.png)



kali > `msfconsole`打开

之后使用模块

![image-20220523101043259](操作系统安全.assets/image-20220523101043259.png)

选择TCP扫描模块

![image-20220523101151569](操作系统安全.assets/image-20220523101151569.png)

之后用`show option`查看设置项

![image-20220523101258046](操作系统安全.assets/image-20220523101258046.png)

用`set`设置攻击目标，之后用`run`启动模块

![image-20220523102120839](操作系统安全.assets/image-20220523102120839.png)

然后用`exploit`启动渗透模块

![image-20220523102345762](操作系统安全.assets/image-20220523102345762.png)

`back 返回上个窗口`

`info 列出信息`

### 2.2 MetSploit 工具

MetSploit 是一个使用内存技术的攻击载荷，可以注入到进程中。

![image-20220523102754770](操作系统安全.assets/image-20220523102754770.png)

## 3. Windows 漏洞利用与防护

### 3.1 MS08-067（CVE-2008-4250）

- 是一个具有里程碑意义的 Windows SMB漏洞
- 是典型的Windows缓冲区溢出漏洞

记得复现！

首先更新一下kali的数据库

![image-20220523153016533](操作系统安全.assets/image-20220523153016533.png)

然后启动工具，使用端口扫描模块，查看需要设置的信息，然后选择攻击对象。

![image-20220523153351875](操作系统安全.assets/image-20220523153351875.png)

攻击对象是我的Windows XP虚拟机

![image-20220523153216085](操作系统安全.assets/image-20220523153216085.png)

run的时候需要关闭xp的防火墙，（奶奶滴！这也太逊了吧）我们可以看到它开启了445端口

![image-20220523153746463](操作系统安全.assets/image-20220523153746463.png)

再用Nmap扫描获得一些信息

![image-20220523154109549](操作系统安全.assets/image-20220523154109549.png)

我们看到它是WindowsXP系统，那他就可能有ms08_067漏洞，那么用search查找一下，果然如此！

![image-20220523154245729](操作系统安全.assets/image-20220523154245729.png)

我们利用这个漏洞模块，他会自己给我们提供默认的payload ，然后查看一下设置项，发现需要一个攻击目标RHOSTS。

![image-20220523154506263](操作系统安全.assets/image-20220523154506263.png)

我们set一下攻击目标，也可以再手动set一下payload

![image-20220523154823435](操作系统安全.assets/image-20220523154823435.png)

之后是一连串的失败！！！！

与视频讲的不太一样！我们需要手动set target！

![image-20220523165842725](操作系统安全.assets/image-20220523165842725.png)

此外我们还需要在Windows上开启三个服务：

1. server
2. computer browser 
3. workstation

并且关闭防火墙和自动更新

![image-20220523170046065](操作系统安全.assets/image-20220523170046065.png)

用sys info查看信息

![image-20220523170218869](操作系统安全.assets/image-20220523170218869.png)

之后是拿到系统权限`getsystem`，然后打开控制台 `shell`，dir 查看当前目录

![image-20220523170400138](操作系统安全.assets/image-20220523170400138.png)

已经完全牛了这个windows xp！



### 3.2 MS17-010(永恒之蓝)

- Windows SMB
- Windows xp - Windows 2016

复现：

先用`search ms17_010`查找一下

![image-20220523175949583](操作系统安全.assets/image-20220523175949583.png)

使用漏洞攻击

![image-20220523195340833](操作系统安全.assets/image-20220523195340833.png)

![image-20220523195405780](操作系统安全.assets/image-20220523195405780.png)

攻击成功之后拿shell

![image-20220523195534261](操作系统安全.assets/image-20220523195534261.png)

### 3.3 CVE-2019-0708 (BlueKeep)

- 通过远程桌面端口 3389 ，RDP协议进行攻击。



### 4. Linux 漏洞利用与防护

#### 4.1 CVE-2017-7494

Samba 远程代码执行漏洞

修复方式，升级Samba

没有2017版kali 回头复现

#### 4.2 CVE-2016-5195 （脏牛 Dirty COW）

漏洞危害：低权限用户利用该漏洞进行提权



**复现：**

首先拿到平台实验环境

![image-20220523192552484](操作系统安全.assets/image-20220523192552484.png)

靶机连不上！明天再说





